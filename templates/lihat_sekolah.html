<!-- ===================== -->
<!-- File: lihat_sekolah.html -->
<!-- ===================== -->
<!DOCTYPE html>
<html>
<head>
  <title>Lihat Sekolah - SRCS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">

  <h2 class="mb-4">Detail Sekolah</h2>
  <ul class="list-group mb-3">
    <li class="list-group-item"><strong>Nama Sekolah:</strong> {{ sekolah.nama }}</li>
    <li class="list-group-item"><strong>Kabupaten:</strong> {{ sekolah.kabupaten }}</li>
    <li class="list-group-item"><strong>Tanggal Kunjungan:</strong> {{ sekolah.tanggal_kunjungan.strftime('%d-%m-%Y') }}</li>
  </ul>

  <!-- QR / Link Absen -->
  <div class="mb-4">
    <h5>Form Absensi Peserta</h5>
    <p>Bagikan link atau QR code ini ke peserta:</p>
    <a href="{{ form_url }}" target="_blank" class="btn btn-primary btn-sm">Isi Absen</a>
    <div class="mt-2">
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ form_url }}" alt="QR Absen">
    </div>
  </div>

  <!-- Data Peserta -->
  <div class="mb-4">
    <h5>Daftar Peserta</h5>
    {% if peserta %}
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Kelas</th>
            <th>Jenis Motor Honda Yang Disukai</th>
            <th>No HP</th>
            <th>Waktu Absen</th>
          </tr>
        </thead>
        <tbody>
          {% for p in peserta %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ p.nama }}</td>
            <td>{{ p.kelas or '-' }}</td>
            <td>{{ p.jenis_motor or '-' }}</td>
            <td>{{ p.no_hp or '-' }}</td>
            <td>{{ p.created_at.strftime('%d-%m-%Y %H:%M') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">Belum ada peserta yang mengisi absen.</p>
    {% endif %}
  </div>

  <!-- Rekap Motor Parkiran -->
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Data Motor di Parkiran (Rekap)</h5>
      {% if role == 'PetugasSR' %}
        <a class="btn btn-success btn-sm"
           href="{{ url_for('parkir_tambah', sekolah_id=sekolah.id) }}">+ Tambah Data Parkir</a>
      {% endif %}
    </div>

    {% if brand_totals %}
      <!-- Total per Merek -->
      <h6 class="mt-3">Total per Merek</h6>
      <table class="table table-bordered mt-2">
        <thead class="table-dark">
          <tr>
            <th>Merek</th>
            <th>Total Unit</th>
          </tr>
        </thead>
        <tbody>
          {% for brand, t in brand_totals.items() %}
          <tr>
            <td>{{ brand }}</td>
            <td>{{ t }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Detail per Model di tiap Merek -->
      {% for brand, models in rekap.items() %}
        <h6 class="mt-4">{{ brand }}</h6>
        <table class="table table-striped table-bordered">
          <thead class="table-dark">
            <tr>
              <th>No</th>
              <th>Model</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {% for model, total in models.items() %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ model }}</td>
              <td>{{ total }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endfor %}
    {% else %}
      <p class="text-muted mt-2">Belum ada data motor di parkiran.</p>
    {% endif %}
  </div>

  <a href="/safety-riding/sekolah" class="btn btn-secondary">&larr; Kembali</a>
</div>
</body>
</html>
